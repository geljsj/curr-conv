<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Currency Converter</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2489/2489756.png">
    <style>
        :root { --bg: #f0f2f5; --card: #ffffff; --text: #000000; --label: #222222; --input-bg: #f5f6f7; --primary: #007aff; }
        @media(prefers-color-scheme: dark) { :root { --bg: #121212; --card: #1e1e1e; --text: #ffffff; --label: #eeeeee; --input-bg: #2c2c2e; } }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        h2 { text-align: center; color: var(--text); font-size: 24px; margin: 5px 0 20px 0; font-weight: 800; }
        #inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        label { display: block; margin-bottom: 4px; font-size: 12.5px; font-weight: 600; color: var(--label); }
        input { width: 100%; padding: 10px; border: 2px solid var(--input-bg); border-radius: 10px; font-size: 17px; font-weight: 600; background: var(--input-bg); color: var(--text); box-sizing: border-box; outline: none; -webkit-appearance: none; }
        input:focus { border-color: var(--primary); background: var(--card); }
        .tip-container { display: flex; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd; }
        .tip-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: 600; font-size: 14px; cursor: pointer; }
        .status { font-size: 10px; text-align: center; color: var(--label); margin-top: 15px; font-weight: 700; opacity: 0.6; }
    </style>
</head>
<body>
<div class="card">
    <h2>üåç ÏÑ∏Í≥ÑÏó¨Ìñâ ÌÜµÌôî Î≥ÄÌôòÍ∏∞</h2>
    <div id="inputs"></div>
    <div class="tip-container">
        <button class="tip-btn" onclick="applyTip(1.1)">+ 10%</button>
        <button class="tip-btn" onclick="applyTip(1.15)">+ 15%</button>
        <button class="tip-btn" onclick="applyTip(1.2)">+ 20%</button>
    </div>
    <div class="status" id="last-update">ÏµúÏã† ÌôòÏú® ÌôïÏù∏ Ï§ë...</div>
</div>

<script>
const currencies = [
    {code:'KRW', name:'ÎåÄÌïúÎØºÍµ≠ üá∞üá∑'}, {code:'USD', name:'ÎØ∏Íµ≠ üá∫üá∏'}, {code:'EUR', name:'Ïú†ÎüΩ Ïó∞Ìï© üá™üá∫'},
    {code:'GBP', name:'ÏòÅÍµ≠ üá¨üáß'}, {code:'AED', name:'UAE üá¶üá™'}, {code:'JPY', name:'ÏùºÎ≥∏ üáØüáµ'},
    {code:'CZK', name:'Ï≤¥ÏΩî üá®üáø'}, {code:'HUF', name:'ÌóùÍ∞ÄÎ¶¨ üá≠üá∫'}, {code:'TRY', name:'ÌäÄÎ•¥ÌÇ§Ïòà üáπüá∑'},
    {code:'THB', name:'ÌÉúÍµ≠ üáπüá≠'}, {code:'VND', name:'Î≤†Ìä∏ÎÇ® üáªüá≥'}
];

let rates = {};
let lastFocusedId = 'KRW';

function renderInputs() {
    const container = document.getElementById('inputs');
    container.innerHTML = '';
    currencies.forEach(cur => {
        const group = document.createElement('div');
        group.innerHTML = `
            <label>${cur.code} (${cur.name})</label>
            <input type="text" inputmode="decimal" id="${cur.code}" placeholder="0" 
                   oninput="handleInput('${cur.code}')" 
                   onfocus="lastFocusedId='${cur.code}'; setTimeout(() => event.target.select(), 50);"
                   onclick="this.select();">`;
        container.appendChild(group);
    });
}

async function fetchRates() {
    try {
        const res = await fetch('https://open.er-api.com/v6/latest/KRW');
        const data = await res.json();
        if (data.result === "success") {
            rates = data.rates;
            localStorage.setItem('savedRates', JSON.stringify(rates));
            document.getElementById('last-update').innerText = "‚úÖ Ïã§ÏãúÍ∞Ñ ÌôòÏú® Ï†ÅÏö©Îê®";
        }
    } catch(e) {
        rates = JSON.parse(localStorage.getItem('savedRates')) || {};
        document.getElementById('last-update').innerText = "‚ö†Ô∏è Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© Ï§ë";
    }
    renderInputs();
}

function formatCurrency(code, value) {
    if (value === 0) return '';
    const noDecimal = ['KRW','JPY','VND','HUF'];
    return Number(value).toLocaleString(undefined, {
        minimumFractionDigits: 0,
        maximumFractionDigits: noDecimal.includes(code) ? 0 : 2
    });
}

function handleInput(code) {
    const el = document.getElementById(code);
    let val = el.value.replace(/,/g, '');
    if (val === '' || isNaN(val)) {
        updateAll(code, 0);
        return;
    }
    updateAll(code, parseFloat(val));
}

function updateAll(changedCode, val) {
    if (!rates[changedCode]) return;
    const baseKRW = val / rates[changedCode];
    currencies.forEach(c => {
        if (c.code !== changedCode) {
            const result = baseKRW * rates[c.code];
            document.getElementById(c.code).value = formatCurrency(c.code, result);
        }
    });
}

function applyTip(ratio) {
    const el = document.getElementById(lastFocusedId);
    let val = parseFloat(el.value.replace(/,/g, ''));
    if (!isNaN(val)) {
        const tipped = val * ratio;
        el.value = formatCurrency(lastFocusedId, tipped);
        updateAll(lastFocusedId, tipped);
    }
}

fetchRates();
</script>
</body>
</html>