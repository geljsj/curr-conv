<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„¸ê³„ì—¬í–‰ í™˜ìœ¨ ê³„ì‚°ê¸°</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2489/2489756.png">
    <style>
        :root { --bg: #f0f2f5; --card: #ffffff; --text: #000000; --label: #222222; --input-bg: #f5f6f7; --primary: #007aff; }
        @media(prefers-color-scheme: dark) { :root { --bg: #121212; --card: #1e1e1e; --text: #ffffff; --label: #eeeeee; --input-bg: #2c2c2e; } }
        
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 100%; max-width: 420px; }
        h2 { text-align: center; color: var(--text); font-size: 19px; margin: 5px 0 20px 0; font-weight: 700; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 4px; font-size: 13px; font-weight: 600; color: var(--label); }
        input { width: 100%; padding: 12px; border: 2px solid var(--input-bg); border-radius: 10px; font-size: 20px; font-weight: normal; background: var(--input-bg); color: var(--text); box-sizing: border-box; outline: none; -webkit-appearance: none; }
        input:focus { border-color: var(--primary); background: var(--card); }
        .tip-container { display: flex; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--text); }
        .tip-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: 600; font-size: 13px; cursor: pointer; }
        
        /* ìƒíƒœ ë©”ì‹œì§€: ë³¼ë“œì²´ + 80% íˆ¬ëª…ë„ë¡œ ë³µì› */
        .status { 
            font-size: 11px; 
            text-align: center; 
            color: var(--label); 
            margin-top: 15px; 
            font-weight: 700; 
            opacity: 0.8; 
        }
    </style>
</head>
<body>
<div class="card">
    <h2>ğŸŒ ì„¸ê³„ì—¬í–‰ í™˜ìœ¨ ê³„ì‚°ê¸°</h2>
    <div id="inputs"></div>
    <div class="tip-container">
        <button class="tip-btn" onclick="applyTip(1.1)">+ íŒ 10%</button>
        <button class="tip-btn" onclick="applyTip(1.15)">+ íŒ 15%</button>
        <button class="tip-btn" onclick="applyTip(1.2)">+ íŒ 20%</button>
    </div>
    <div class="status" id="last-update">ìµœì‹  í™˜ìœ¨ í™•ì¸ ì¤‘...</div>
</div>

<script>
const currencies = [
    {code:'KRW', name:'ëŒ€í•œë¯¼êµ­ ğŸ‡°ğŸ‡·'}, {code:'USD', name:'ë¯¸êµ­ ğŸ‡ºğŸ‡¸'}, {code:'JPY', name:'ì¼ë³¸ ğŸ‡¯ğŸ‡µ'},
    {code:'EUR', name:'ìœ ëŸ½ ì—°í•© ğŸ‡ªğŸ‡º'}, {code:'GBP', name:'ì˜êµ­ ğŸ‡¬ğŸ‡§'}, {code:'CZK', name:'ì²´ì½” ğŸ‡¨ğŸ‡¿'},
    {code:'HUF', name:'í—ê°€ë¦¬ ğŸ‡­ğŸ‡º'}, {code:'TRY', name:'íŠ€ë¥´í‚¤ì˜ˆ ğŸ‡¹ğŸ‡·'}, {code:'VND', name:'ë² íŠ¸ë‚¨ ğŸ‡»ğŸ‡³'}
];

let rates = {};
let lastFocusedId = 'KRW';

async function fetchRates() {
    try {
        const res = await fetch('https://open.er-api.com/v6/latest/KRW');
        const data = await res.json();
        rates = data.rates;
        localStorage.setItem('savedRates', JSON.stringify(rates));
        document.getElementById('last-update').innerText = "âœ… ì‹¤ì‹œê°„ í™˜ìœ¨ ì ìš©ë¨";
    } catch(e) {
        rates = JSON.parse(localStorage.getItem('savedRates')) || {};
        document.getElementById('last-update').innerText = "âš ï¸ ì €ì¥ëœ ë°ì´í„° ì‚¬ìš© ì¤‘";
    }
    renderInputs();
}

function renderInputs() {
    const container = document.getElementById('inputs');
    container.innerHTML = '';
    currencies.forEach(cur => {
        const group = document.createElement('div');
        group.className = 'input-group';
        // inputmode="decimal"ì„ í†µí•´ ìˆ«ì íŒ¨ë“œ í˜¸ì¶œ
        group.innerHTML = `<label>${cur.code} (${cur.name})</label>
                           <input type="text" inputmode="decimal" pattern="[0-9]*" id="${cur.code}" placeholder="0" 
                                  oninput="handleInput('${cur.code}')" 
                                  onfocus="lastFocusedId='${cur.code}'">`;
        container.appendChild(group);
    });
}

function handleInput(code) {
    const el = document.getElementById(code);
    let val = el.value.replace(/,/g, '');
    if (isNaN(val) || val === '') {
        currencies.forEach(c => { if(c.code !== code) document.getElementById(c.code).value = ''; });
        return;
    }
    el.value = Number(val).toLocaleString();
    updateAll(code, parseFloat(val));
}

function updateAll(changedCode, val){
    const baseKRW = val / rates[changedCode];
    currencies.forEach(c => {
        if(c.code !== changedCode && rates[c.code]) {
            const res = (baseKRW * rates[c.code]).toFixed(2);
            document.getElementById(c.code).value = Number(res).toLocaleString();
        }
    });
}

function applyTip(ratio) {
    const activeEl = document.getElementById(lastFocusedId);
    if (activeEl) {
        let val = parseFloat(activeEl.value.replace(/,/g, ''));
        if (!isNaN(val)) {
            const tippedVal = (val * ratio).toFixed(2);
            activeEl.value = Number(tippedVal).toLocaleString();
            updateAll(lastFocusedId, tippedVal);
        }
    }
}

fetchRates();
</script>
</body>
</html>
